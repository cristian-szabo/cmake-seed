os: linux
sudo: false
language: cpp

# Define order of project stages
stages:
  - prebuild
  - build
  - postBuild
  - test
  - deploy

env:
  global:
    - PATH=$HOME/.local/bin:$PATH

before_install:
  - pip install --user awscli
  - mkdir -p ~/artifacts
  - aws s3 sync s3://cmake-seed/artifacts ~/artifacts

after_success:
  - aws s3 sync ~/artifacts s3://cmake-seed/artifacts
  
jobs:
  include:
    # Define jobs for pre-build stage    
    - stage: prebuild
      script: 
        - |
          echo "pre-build job1"
          echo one | tee > ~/artifacts/one
    - stage: prebuild
      script: 
        - |
          echo "pre-build job2"
          echo two | tee > ~/artifacts/two
    - stage: prebuild
      script: 
        - |
          echo "pre-build job3"         
              
    # Define jobs for build stage
    - stage: build
      script: 
        - |
          echo "build job1"
    - stage: build
      script: 
        - |
          echo "build job2"
          cat ~/artifacts/*          
          
    # Define jobs for post-build stage
    - stage: postbuild
      script: 
        - |
          echo "post-build job1"
    - stage: postbuild
      script: 
        - |
          echo "post-build job2"
    - stage: postbuild
      script: 
        - |
          echo "post-build job3"

    # Define jobs for test stage
    - stage: test
      script: 
        - |
          echo "test job1"
    - stage: test
      script: 
        - |
          echo "test job2"
          
    # Define jobs for deploy stage
    - stage: deploy
      script: 
        - |
          echo "deploy job"